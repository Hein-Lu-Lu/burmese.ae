<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UAE Salary Budget & Advice Calculator</title>

  <!-- Tailwind CDN (for production: compile Tailwind instead of CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          boxShadow: { soft: "0 10px 30px rgba(0,0,0,.10)" }
        }
      }
    }
  </script>
</head>

<body class="min-h-screen bg-white text-slate-900">
  <!-- HEADER -->
  <header
    id="site-header"
    class="fixed inset-x-0 top-0 z-50 border-b border-slate-200/60 bg-white/30 backdrop-blur-md"
  >
    <nav class="mx-auto flex max-w-6xl items-center justify-between px-4 py-3 sm:px-6 lg:px-8">
      <a href="#" class="flex items-center gap-3">
        <img
          src="https://cdn.burmese.ae/logo/burmese.ae%20icon.svg"
          alt="Burmese.ae"
          class="h-10 w-auto"
        />
      </a>

      <div class="hidden items-center gap-7 text-sm font-medium text-slate-700 md:flex">
        <a href="#about" class="hover:text-slate-900">About</a>
        <a href="#services" class="hover:text-slate-900">Service</a>
        <a href="#contact" class="hover:text-slate-900">Contact</a>
      </div>

      <img
        src="https://cdn.burmese.ae/logo/uae-mm.svg"
        alt="uae-mm"
        class="h-6 w-auto object-contain"
      />
    </nav>
  </header>

  <!-- MAIN -->
  <main class="mx-auto max-w-6xl px-4 pb-16 pt-28 sm:px-6 lg:px-8">
    <!-- TITLE -->
    <section class="mb-6">
      <h1 class="text-2xl font-extrabold tracking-tight text-slate-900 sm:text-3xl">
        UAE Salary Budget & Advice Calculator
      </h1>
      <p class="mt-3 max-w-3xl text-sm leading-6 text-slate-600 sm:text-base">
        <span class="font-semibold">basic salary</span> နဲ့ နေထိုင်ရာ <span class="font-semibold">emirate</span> ကိုထည့်ပေးပါ။
        သင့်လစာအပေါ် အခြေခံပြီး အိမ်နဲ့ အသုံးစရိတ် စီမံချက်ကို ပြန်လည်တွက်ချက်ပေးပါမယ်။
      </p>
    </section>

    <!-- GRID -->
    <section class="grid gap-4 lg:grid-cols-[420px_1fr]">
      <!-- INPUTS CARD -->
      <section class="rounded-2xl border border-slate-200 bg-white shadow-soft">
        <div class="flex items-start justify-between gap-3 border-b border-slate-100 px-5 py-4">
          <h2 class="text-sm font-bold text-slate-900">Inputs</h2>
          <span class="rounded-full border border-slate-200 bg-slate-50 px-3 py-1 text-xs font-medium text-slate-700">
            2 inputs only
          </span>
        </div>

        <div class="px-5 py-4">
          <div class="grid gap-3">
            <div>
              <label for="salary" class="mb-1.5 block text-xs font-semibold text-slate-700">
                Basic salary (AED / month)
              </label>
              <input
                id="salary"
                type="number"
                inputmode="numeric"
                placeholder="e.g., 4500"
                min="0"
                step="50"
                class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm text-slate-900 placeholder:text-slate-400 outline-none ring-0 focus:border-violet-400 focus:ring-4 focus:ring-violet-100"
              />
            </div>

            <div>
              <label for="location" class="mb-1.5 block text-xs font-semibold text-slate-700">
                Location (Emirate / City)
              </label>
              <select
                id="location"
                class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm text-slate-900 outline-none ring-0 focus:border-violet-400 focus:ring-4 focus:ring-violet-100"
              >
                <option value="Dubai">Dubai</option>
                <option value="AbuDhabi">Abu Dhabi</option>
                <option value="Sharjah">Sharjah</option>
                <option value="Ajman">Ajman</option>
                <option value="RAK">Ras Al Khaimah</option>
                <option value="Fujairah">Fujairah</option>
                <option value="UAQ">Umm Al Quwain</option>
                <option value="AlAin">Al Ain</option>
              </select>
            </div>

            <button
              id="calcBtn"
              class="mt-1 inline-flex w-full items-center justify-center rounded-xl bg-violet-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm transition hover:bg-violet-700 focus:outline-none focus:ring-4 focus:ring-violet-200"
              type="button"
            >
              Calculate my plan
            </button>
          </div>

          <!-- NEW: Adjustable Controls -->
          <div id="adjustBox" class="mt-4 hidden rounded-2xl border border-slate-200 bg-slate-50 p-4">
            <div class="flex items-start justify-between gap-3">
              <div>
                <div class="text-xs font-semibold text-slate-700">Adjust Accommodation & Utilities</div>
                <div class="mt-1 text-xs text-slate-600">
                  Slide left to reduce expenses → Savings/Investing increases automatically.
                </div>
              </div>
              <span class="rounded-full border border-slate-200 bg-white px-2.5 py-1 text-xs font-semibold text-slate-700">
                Live update
              </span>
            </div>

            <!-- Accommodation slider -->
            <div class="mt-4">
              <div class="flex items-center justify-between">
                <label for="accSlider" class="text-xs font-semibold text-slate-700">Accommodation %</label>
                <div class="text-xs font-semibold text-slate-900 tabular-nums">
                  <span id="accPctLabel">—</span>
                </div>
              </div>
              <input
                id="accSlider"
                type="range"
                min="0"
                max="100"
                step="1"
                class="mt-2 w-full accent-violet-600"
              />
              <div class="mt-1 flex items-center justify-between text-[11px] text-slate-500">
                <span id="accMinLabel">min —%</span>
                <span id="accBaseLabel">base —%</span>
                <span id="accMaxLabel">max —%</span>
              </div>
            </div>

            <!-- Utilities slider -->
            <div class="mt-4">
              <div class="flex items-center justify-between">
                <label for="utilSlider" class="text-xs font-semibold text-slate-700">Utilities %</label>
                <div class="text-xs font-semibold text-slate-900 tabular-nums">
                  <span id="utilPctLabel">—</span>
                </div>
              </div>
              <input
                id="utilSlider"
                type="range"
                min="0"
                max="100"
                step="1"
                class="mt-2 w-full accent-violet-600"
              />
              <div class="mt-1 flex items-center justify-between text-[11px] text-slate-500">
                <span id="utilMinLabel">min —%</span>
                <span id="utilBaseLabel">base —%</span>
                <span id="utilMaxLabel">max —%</span>
              </div>
            </div>

            <button
              id="resetAdjustBtn"
              type="button"
              class="mt-4 inline-flex w-full items-center justify-center rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-50 focus:outline-none focus:ring-4 focus:ring-violet-100"
            >
              Reset sliders to recommended
            </button>
          </div>

          <!-- Income Class KPI -->
          <div
            id="classBox"
            class="mt-4 hidden rounded-2xl border border-slate-200 bg-slate-50 p-4"
          >
            <div class="flex items-start justify-between gap-3">
              <div>
                <div class="text-xs font-medium text-slate-600">Income class</div>
                <div class="mt-1 text-lg font-extrabold text-slate-900" id="incomeClass">—</div>
              </div>
              <span
                id="classTag"
                class="rounded-full border border-slate-200 bg-white px-2.5 py-1 text-xs font-semibold text-slate-700"
              >—</span>
            </div>
            <p id="classText" class="mt-2 text-sm leading-6 text-slate-600"></p>
          </div>
        </div>

        <div class="border-t border-slate-100 bg-slate-50 px-5 py-4 text-xs leading-5 text-slate-600">
          <span class="font-semibold text-slate-800">Important:</span>
          ဒီဟာက အခြေခံလမ်းညွှန်ချက်ပဲ ဖြစ်ပါတယ်။ financial advisor မဟုတ်ပါ။
          တကယ့်စီမံချက်တွေအတွက်တော့ licensed financial advisor နဲ့ ဆွေးနွေးဖို့ အကြံပြုပါတယ်။ idea ရဖို့ကိုပဲ အသုံးပြုပါ။
        </div>
      </section>

      <!-- OUTPUT CARD -->
      <section class="rounded-2xl border border-slate-200 bg-white shadow-soft">
        <div class="flex items-start justify-between gap-3 border-b border-slate-100 px-5 py-4">
          <h2 class="text-sm font-bold text-slate-900">Your monthly plan</h2>
          <span
            id="locationPill"
            class="rounded-full border border-slate-200 bg-slate-50 px-3 py-1 text-xs font-medium text-slate-700"
          >—</span>
        </div>

        <div class="px-5 py-4">
          <!-- KPIs -->
          <div class="grid gap-3 sm:grid-cols-2">
            <div
              id="kpiTakeHome"
              class="hidden rounded-2xl border border-slate-200 bg-slate-50 p-4"
            >
              <div class="flex items-start justify-between gap-3">
                <div>
                  <div class="text-xs font-medium text-slate-600">အသုံးပြုပြီးသော salary</div>
                  <div class="mt-1 text-lg font-extrabold text-slate-900" id="salaryUsed">—</div>
                </div>
                <span class="rounded-full border border-emerald-200 bg-emerald-50 px-2.5 py-1 text-xs font-semibold text-emerald-700">
                  AED
                </span>
              </div>
              <p class="mt-2 text-sm leading-6 text-slate-600">
                သင့်လစာအပေါ် အခြေခံပြီး တွက်ချက်ခြင်းကို ပြုလုပ်ပါမည်။
              </p>
            </div>

            <div
              id="kpiSavings"
              class="hidden rounded-2xl border border-slate-200 bg-slate-50 p-4"
            >
              <div class="flex items-start justify-between gap-3">
                <div>
                  <div class="text-xs font-medium text-slate-600">Savings + investing အတွက် Target</div>
                  <div class="mt-1 text-lg font-extrabold text-slate-900" id="saveInvest">—</div>
                </div>
                <span
                  id="saveTag"
                  class="rounded-full border border-slate-200 bg-white px-2.5 py-1 text-xs font-semibold text-slate-700"
                >—</span>
              </div>

              <div class="mt-3 h-2.5 w-full overflow-hidden rounded-full border border-slate-200 bg-white">
                <div id="saveBar" class="h-full w-0 rounded-full bg-violet-600"></div>
              </div>

              <p class="mt-2 text-sm leading-6 text-slate-600" id="saveNote">—</p>
            </div>
          </div>

          <!-- Budget List -->
          <ul id="budgetList" class="mt-4 grid gap-3"></ul>
        </div>

        <div class="border-t border-slate-100 bg-slate-50 px-5 py-4 text-xs leading-5 text-slate-600">
          <span class="font-semibold text-slate-800">Tip:</span>
          Accommodation စရိတ်ကများနေရင် shared accommodation (room share) ကို စဉ်းစားပါ။
          Rent က ၄၀% ထက်မကျော်သင့်ပါ။ သက်သာမယ့်နေရာတွေမှာနေပြီး public transport ကို အသုံးပြုနိုင်ရင်
          Commute စရိတ်လည်း သက်သာမှာ ဖြစ်ပါတယ်။
        </div>
      </section>

      <!-- FACTS (full width) -->
      <section class="lg:col-span-2 rounded-2xl border border-slate-200 bg-white shadow-soft">
        <div class="flex items-start justify-between gap-3 border-b border-slate-100 px-5 py-4">
          <h2 class="text-sm font-bold text-slate-900">UAE မှာ သိသင့်သော အကြောင်းအရာများ</h2>
          <span class="rounded-full border border-slate-200 bg-slate-50 px-3 py-1 text-xs font-medium text-slate-700">
            Notes
          </span>
        </div>

        <div class="px-5 py-4">
          <div class="grid gap-3 sm:grid-cols-2">
            <details class="rounded-2xl border border-slate-200 bg-slate-50 p-4" open>
              <summary class="cursor-pointer text-sm font-bold text-slate-900">
                Dubai RTA nol fares & 30-day travel pass
              </summary>
              <div class="mt-3 text-sm leading-6 text-slate-600">
                From RTA’s nol fares page: typical fares (Silver/Gold/Personal/Red Ticket) and “nol Products Prices” (7/30/90/365 days).
                <br><br>
                <span class="font-semibold text-slate-800">30 Days (Silver):</span>
                1 zone <span class="font-mono">AED 140</span>,
                2 zones <span class="font-mono">AED 230</span>,
                all zones <span class="font-mono">AED 350</span>.
                <div class="mt-3 overflow-x-auto">
                  <table class="w-full border-collapse text-xs">
                    <thead>
                      <tr class="text-left text-slate-600">
                        <th class="border-b border-slate-200 p-2">Journey</th>
                        <th class="border-b border-slate-200 p-2">Silver</th>
                        <th class="border-b border-slate-200 p-2">Gold</th>
                        <th class="border-b border-slate-200 p-2">Personal</th>
                        <th class="border-b border-slate-200 p-2">Red Ticket</th>
                      </tr>
                    </thead>
                    <tbody class="text-slate-700">
                      <tr>
                        <td class="border-b border-slate-200 p-2">Within 1 zone</td>
                        <td class="border-b border-slate-200 p-2">AED 3</td>
                        <td class="border-b border-slate-200 p-2">AED 6</td>
                        <td class="border-b border-slate-200 p-2">AED 3</td>
                        <td class="border-b border-slate-200 p-2">AED 4</td>
                      </tr>
                      <tr>
                        <td class="border-b border-slate-200 p-2">2 adjacent zones</td>
                        <td class="border-b border-slate-200 p-2">AED 5</td>
                        <td class="border-b border-slate-200 p-2">AED 10</td>
                        <td class="border-b border-slate-200 p-2">AED 5</td>
                        <td class="border-b border-slate-200 p-2">AED 6</td>
                      </tr>
                      <tr>
                        <td class="border-b border-slate-200 p-2">More than 2 zones</td>
                        <td class="border-b border-slate-200 p-2">AED 7.5</td>
                        <td class="border-b border-slate-200 p-2">AED 15</td>
                        <td class="border-b border-slate-200 p-2">AED 7.5</td>
                        <td class="border-b border-slate-200 p-2">AED 8.5</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
                <p class="mt-3 text-xs text-slate-600">
                  Note: RTA states registered cards are eligible for 7/30/90/365-day travel passes; anonymous silver/gold only for 7-day pass.
                </p>
              </div>
            </details>

            <details class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
              <summary class="cursor-pointer text-sm font-bold text-slate-900">
                Dubai housing reference (high-level)
              </summary>
              <div class="mt-3 text-sm leading-6 text-slate-600">
                Dubai average rents vary a lot by area. One published reference (late 2025) lists overall averages (yearly) such as
                Studio ~AED 40,961 and 1-Bedroom ~AED 61,968 (≈ AED 5,164/month). Use this as a rough benchmark only.
              </div>
            </details>

            <details class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
              <summary class="cursor-pointer text-sm font-bold text-slate-900">
                Utilities reference
              </summary>
              <div class="mt-3 text-sm leading-6 text-slate-600">
                တစ်ကိုယ်ရည် တစ်ကာယ အတွက် အသုံးစရိတ်တွေ ကွာခြားနိုင်ပါတယ်။
              </div>
            </details>

            <details class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
              <summary class="cursor-pointer text-sm font-bold text-slate-900">
                Medical / insurance note
              </summary>
              <div class="mt-3 text-sm leading-6 text-slate-600">
                UAE တွင် အများစုမှ အလုပ်ရှင်က insurance ကို ပေးထားပါတယ်။ မပေးရင်တော့ coverage အလိုက် စရိတ်များကွာခြားနိုင်ပါတယ်။
                ဒီ calculator မှာ အခြေခံ "medical buffer" ခွဲခြားထားပြီး အရင်ဆုံး emergency fund တည်ဆောက်ဖို့ အကြံပြုပါတယ်။
              </div>
            </details>
          </div>
        </div>
      </section>
    </section>
  </main>

  <!-- FOOTER STRIP -->
  <div class="border-t border-slate-200 bg-gradient-to-r from-orange-400 to-orange-300">
    <div class="mx-auto max-w-6xl px-4 py-2 text-xs text-slate-700 sm:px-6 sm:text-sm lg:px-8">
      <div class="flex flex-col gap-1 sm:flex-row sm:items-center sm:justify-between">
        <div class="truncate">
          <span class="font-semibold text-slate-900">Email:</span>
          <a href="mailto:contact@burmese.ae" class="ml-1 hover:text-slate-900">contact@burmese.ae</a>
        </div>

        <div class="truncate">
          <span class="font-semibold text-slate-900">Phone:</span>
          <a href="tel:+971545077861" class="ml-1 hover:text-slate-900">+971 545 077 861</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="mx-auto max-w-6xl px-4 py-4 text-center text-xs text-slate-600 sm:px-6 lg:px-8">
    this is for the purpose of general budgeting guidance only. not personal financial advice. &copy; 2025 burmese.ae
  </footer>

  <!-- UPDATED CALCULATOR SCRIPT -->
  <script>
    // ---------------------------
    // UAE Budget Engine + Adjustable Accommodation/Utilities
    // ---------------------------

    const LOCATION = {
      Dubai:    { name: "Dubai",          idx: 1.15 },
      AbuDhabi: { name: "Abu Dhabi",      idx: 1.10 },
      Sharjah:  { name: "Sharjah",        idx: 0.92 },
      Ajman:    { name: "Ajman",          idx: 0.88 },
      RAK:      { name: "Ras Al Khaimah", idx: 0.85 },
      Fujairah: { name: "Fujairah",       idx: 0.84 },
      UAQ:      { name: "Umm Al Quwain",  idx: 0.82 },
      AlAin:    { name: "Al Ain",         idx: 0.90 },
    };

    function classifyIncome(salary){
      if (salary <= 0) return { key:"none", label:"—", tag:"warn", msg:"Enter a valid salary to get a plan." };
      if (salary < 5000)  return { key:"low",    label:"Lower income",  tag:"bad",
        msg:"Focus on essentials: keep housing low (shared room), avoid high debt, build an emergency buffer first." };
      if (salary < 15000) return { key:"mid",    label:"Middle income", tag:"warn",
        msg:"Balance lifestyle with progress: keep housing reasonable, build emergency fund, then invest consistently." };
      return { key:"high", label:"High income",  tag:"good",
        msg:"Optimize: stronger investing, better coverage, and long-term wealth planning (diversified assets)." };
    }

    const BUDGET = {
      low: [
        { k:"Accommodation",   p:38, note:"Shared နေတာကို recommend ပေးပါတယ်၊ rent က ၄၀​% ထက်မကျော်သင့်ပါ။ " },
        { k:"Utilities",       p: 6, note:"တစ်ကိုယ်ရည် သန့်ရှင်းမှုကို ဦးစားပေးပါ" },
        { k:"Food & Groceries",p:14, note:"ချက်စားပါ အပြင်မှာစားတာမျိုး​ရံဖန်ရံခါပဲ ပြုလုပ်သင့်ပါတယ်" },
        { k:"Commute",         p: 8, note:"Public transport ကိုပဲအကြုံပြုပါတယ်." },
        { k:"Medical Buffer",  p: 5, note:"အလုပ်ရှင်က insurance ပေးထားရင်တော့ ဒါက သင့်အတွက်အပိုဝင်ငွေဖြစ်နိုင်ပါတယ်" },
        { k:"Telecom/Internet",p: 1, note:"အိမ်က wifi ကိုပဲအသုံးပြုပါ၊ ဖုန်းခေါ်ဖို့ internet package နည်းနည်းပါးပါးဝယ်ဖို့ပဲအကြုံပြုပါတယ်." },
        { k:"Lifestyle",       p: 5, note:"အားကစားလုပ်ပါ၊ ကျန်းမာခြင်းက လာဘ်တစ်ပါးပါ." },
        { k:"Family/Other",    p: 6, note:"တစ်ခြား expense တွေကို ကာနိုင်ရင် အိမ်ကိုပိုပို့လိုရပါတယ်" },
        { k:"Emergency Fund",  p:12, note:"အရေးပေါ်အတွက် ပထမ ၃ လလောက်ကို စုထားပါ။ မသုံးဖြစ်ပါက ရင်းနှီးမြှုပ်နှံပါ။" },
        { k:"Investing",       p: 5, note:"ရွှေဝယ်တာမျိုး၊​စုဆောင်းတာမျိုးလုပ်သင့်ပါတယ်" },
      ],
      mid: [
        { k:"Accommodation",   p:32, note:"25–35% ကိုသာ Accomodation အတွက်သုံးတာသင့်တော်ပါသည်။" },
        { k:"Utilities",       p: 6, note:"အိမ်အတွက် လိုအပ်တာများကို ဝယ်ယူပါ။ ချင့်ချိန်သုံးစွဲပါ" },
        { k:"Food & Groceries",p:12, note:"ချက်စားပါ ရံဖန်ရံခါတော့ အပြင်မှာစားလို့အဆင်ပြေပါတယ်." },
        { k:"Commute",         p: 8, note:"လစာပေါ်မူတည်ပြီး public transport ဒါမှမဟုတ် ကိုယ်ပိုင်ကားကိုအသုံးပြုနိုင်ပါတယ်။" },
        { k:"Medical Buffer",  p: 5, note:"အလုပ်ရှင်က insurance ပေးထားရင်တော့ ဒါက သင့်အတွက်အပိုဝင်ငွေဖြစ်နိုင်ပါတယ်" },
        { k:"Telecom/Internet",p: 2, note:"SIM + home internet." },
        { k:"Lifestyle",       p: 9, note:"Entertainment, shopping, travel fund." },
        { k:"Family/Other",    p: 6, note:"တစ်ခြား expense တွေကို ကာနိုင်ရင် အိမ်ကိုပိုပို့လိုရပါတယ်" },
        { k:"Emergency Fund",  p:10, note:"အသုံးမလိုရင် ၃လ ကနေ ၆လအထိစုထားလို့ရပါတယ်" },
        { k:"Investing",       p:10, note:"stock အကြောင်းနားလည်ရင် stock ဝယ်တာက  ရွှေဝယ်တာထက် ရေတိုပိုမြတ်နိုင်ပါတယ်" },
      ],
      high: [
        { k:"Accommodation",   p:25, note:"Accomodation ကိုချင့်ချိန်သင့်ပါတယ်." },
        { k:"Utilities",       p: 5, note:"ချင့်ချိန် အသုံးချသင့်ပါတယ်၊  ငွေယိုပေါက် ဖြစ်နိုင်ပါတယ်" },
        { k:"Food & Groceries",p:10, note:"အချိန်မရှိရင် အပြင်မှာ စားဖို့အဆင်ပြေပါတယ်." },
        { k:"Commute",         p: 7, note:"ကားကိုအသုံးပြုနိုင်ပါတယ်၊​ public transport ထက်ပိုအချိန် save နိုင်ပါတယ်" },
        { k:"Medical Buffer",  p: 6, note:"life insurance လိုမျိုး​ဝယ်ထားဖို့ အကြံပေးပါတယ်." },
        { k:"Telecom/Internet",p: 3, note:"ချင့်ချိန်သုံးစွဲသင့်ပါတယ်" },
        { k:"Lifestyle",       p:12, note:"Travel အတွက်သုံးသင့်ပါတယ် ပိုပြီး အမြင်ဆန်းသစ်စေမှာပါ." },
        { k:"Family/Other",    p: 5, note:"အိမ်ထောင်/ကလေးရှိပါက သူတို့အတွက် ရည်ရွယ်ထားသင့်ပါတယ်." },
        { k:"Emergency Fund",  p: 7, note:"အသုံးမလိုရင် စုထားပြီးပြန်ရင်းနှီးမြုပ်နှံနိုင်ပါတယ်." },
        { k:"Investing",       p:20, note:"long time inverstment တွေလုပ်သင့်ပါတယ်." },
      ],
    };

    const aed = (n) => "AED " + (Math.round(n)).toLocaleString("en-US");

    function rentHints(locationKey){
      const idx = LOCATION[locationKey]?.idx ?? 1.0;
      const shared = [1200, 2500];
      const studio = [2500, 4500];
      const onebr  = [4200, 6500];
      const scale = (arr) => arr.map(v => Math.round(v * idx));
      return { shared: scale(shared), studio: scale(studio), onebr: scale(onebr) };
    }

    function commuteHint(locationKey){
      if(locationKey === "Dubai"){
        return "Dubai RTA 30-day travel pass (Silver): 1 zone AED 140, 2 zones AED 230, all zones AED 350 (registered cards).";
      }
      return "Commute varies by city and whether you use public transport or drive (fuel/parking/tolls).";
    }

    function savingsRating(percent){
      if(percent >= 25) return { cls:"border-emerald-200 bg-emerald-50 text-emerald-700", text:"Strong" };
      if(percent >= 15) return { cls:"border-amber-200 bg-amber-50 text-amber-700", text:"Okay" };
      return { cls:"border-rose-200 bg-rose-50 text-rose-700", text:"Low" };
    }

    // --------- DOM
    const salaryEl = document.getElementById("salary");
    const locEl = document.getElementById("location");
    const btn = document.getElementById("calcBtn");

    const classBox = document.getElementById("classBox");
    const incomeClassEl = document.getElementById("incomeClass");
    const classTag = document.getElementById("classTag");
    const classText = document.getElementById("classText");

    const locationPill = document.getElementById("locationPill");
    const budgetList = document.getElementById("budgetList");

    const kpiTakeHome = document.getElementById("kpiTakeHome");
    const salaryUsed = document.getElementById("salaryUsed");

    const kpiSavings = document.getElementById("kpiSavings");
    const saveInvest = document.getElementById("saveInvest");
    const saveTag = document.getElementById("saveTag");
    const saveBar = document.getElementById("saveBar");
    const saveNote = document.getElementById("saveNote");

    // NEW: sliders
    const adjustBox = document.getElementById("adjustBox");
    const accSlider = document.getElementById("accSlider");
    const utilSlider = document.getElementById("utilSlider");
    const resetAdjustBtn = document.getElementById("resetAdjustBtn");

    const accPctLabel = document.getElementById("accPctLabel");
    const utilPctLabel = document.getElementById("utilPctLabel");
    const accMinLabel = document.getElementById("accMinLabel");
    const accBaseLabel = document.getElementById("accBaseLabel");
    const accMaxLabel = document.getElementById("accMaxLabel");
    const utilMinLabel = document.getElementById("utilMinLabel");
    const utilBaseLabel = document.getElementById("utilBaseLabel");
    const utilMaxLabel = document.getElementById("utilMaxLabel");

    // --------- state
    let lastBaseTpl = null;      // last computed recommended plan (after location tuning + sum fix)
    let sliderInitDone = false;  // to set sliders only once after calculate

    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
    const round1 = (v) => Math.round(v * 10) / 10;

    function findItem(tpl, k){ return tpl.find(i => i.k === k); }

    // Recommended min/max bounds around base (you can tweak these)
    function sliderBoundsFor(key, base){
      // base is percentage
      // Make reasonable floors/ceilings so user cannot break the plan too much
      if(key === "Accommodation"){
        // allow big adjustments but keep realistic
        const min = clamp(base - 18, 10, 60);
        const max = clamp(base + 10, 15, 65);
        return { min: Math.round(min), max: Math.round(max) };
      }
      if(key === "Utilities"){
        const min = clamp(base - 4, 2, 20);
        const max = clamp(base + 6, 4, 25);
        return { min: Math.round(min), max: Math.round(max) };
      }
      return { min: 0, max: 100 };
    }

    // Build a tuned "recommended" template (does NOT apply slider changes yet)
    function buildBaseTemplate(salary, locationKey){
      const loc = LOCATION[locationKey] || LOCATION.Dubai;
      const cls = classifyIncome(salary);
      if(cls.key === "none") return { cls, loc, tpl: [] };

      const tpl = BUDGET[cls.key].map(x => ({...x}));

      // Location tuning (same as your original)
      const tune = Math.max(-0.04, Math.min(0.04, (loc.idx - 1.0) * 0.08));
      const delta = Math.round(tune * 100); // -4..+4

      const housing = findItem(tpl, "Accommodation");
      const utilities = findItem(tpl, "Utilities");
      const lifestyle = findItem(tpl, "Lifestyle");
      const food = findItem(tpl, "Food & Groceries");

      if(housing && utilities && lifestyle && food){
        housing.p += delta;
        utilities.p += Math.round(delta/2);
        lifestyle.p -= Math.round(delta/2);
        food.p -= delta;
      }

      // Fix total to 100 on recommended plan
      const sum = tpl.reduce((a,b)=>a+b.p,0);
      const diff = 100 - sum;
      const other = findItem(tpl,"Family/Other") || tpl[tpl.length-1];
      other.p += diff;

      return { cls, loc, tpl };
    }

    // Apply slider changes:
    // - Accommodation and Utilities become slider values
    // - The "saved" percentage (reduction vs base) is added to Investing
    // - If user increases acc/util above base, Investing decreases (but never below 0),
    //   then Emergency Fund decreases if still needed (never below 0),
    //   then Family/Other decreases if still needed.
    function applyAdjustments(baseTpl, accPct, utilPct){
      const tpl = baseTpl.map(x => ({...x}));

      const acc = findItem(tpl, "Accommodation");
      const util = findItem(tpl, "Utilities");
      const inv = findItem(tpl, "Investing");
      const emg = findItem(tpl, "Emergency Fund");
      const other = findItem(tpl, "Family/Other") || tpl[tpl.length-1];

      const baseAcc = acc?.p ?? 0;
      const baseUtil = util?.p ?? 0;

      if(acc) acc.p = accPct;
      if(util) util.p = utilPct;

      // Total change vs base (positive means user reduced spending -> extra for savings)
      const deltaSave = (baseAcc + baseUtil) - (accPct + utilPct);

      // Helper to move percentage from one bucket to another safely
      const addTo = (item, value) => { if(item) item.p = round1(item.p + value); };

      if(deltaSave > 0){
        // Add the saved amount to Investing first (boost savings)
        addTo(inv, deltaSave);
      } else if(deltaSave < 0){
        // Need to take away from Investing then Emergency then Other
        let need = Math.abs(deltaSave);

        if(inv){
          const take = Math.min(inv.p, need);
          inv.p = round1(inv.p - take);
          need = round1(need - take);
        }
        if(need > 0 && emg){
          const take = Math.min(emg.p, need);
          emg.p = round1(emg.p - take);
          need = round1(need - take);
        }
        if(need > 0 && other){
          const take = Math.min(other.p, need);
          other.p = round1(other.p - take);
          need = round1(need - take);
        }
      }

      // Final normalization (fix rounding drift to exactly 100)
      const sum = tpl.reduce((a,b)=>a+Number(b.p || 0), 0);
      const diff = round1(100 - sum);

      // Put rounding diff into Family/Other (or last item)
      const sink = findItem(tpl, "Family/Other") || tpl[tpl.length-1];
      if(sink) sink.p = round1(sink.p + diff);

      // Prevent negative values (just in case)
      tpl.forEach(i => { i.p = Math.max(0, round1(i.p)); });

      // One more fix if negatives caused drift (rare)
      const sum2 = tpl.reduce((a,b)=>a+Number(b.p || 0), 0);
      const diff2 = round1(100 - sum2);
      if(sink) sink.p = round1(sink.p + diff2);

      return tpl;
    }

    function renderAll({salary, locationKey, cls, loc, tpl}){
      locationPill.textContent = loc.name;

      classBox.classList.remove("hidden");
      incomeClassEl.textContent = cls.label;

      classTag.className = "rounded-full border px-2.5 py-1 text-xs font-semibold";
      if(cls.tag === "good") classTag.classList.add("border-emerald-200","bg-emerald-50","text-emerald-700");
      else if(cls.tag === "warn") classTag.classList.add("border-amber-200","bg-amber-50","text-amber-700");
      else if(cls.tag === "bad") classTag.classList.add("border-rose-200","bg-rose-50","text-rose-700");
      else classTag.classList.add("border-slate-200","bg-white","text-slate-700");

      classTag.textContent = cls.key === "none" ? "—" : cls.label;
      classText.textContent = cls.msg;

      if(cls.key === "none"){
        budgetList.innerHTML = "";
        kpiTakeHome.classList.add("hidden");
        kpiSavings.classList.add("hidden");
        adjustBox.classList.add("hidden");
        return;
      }

      // show
      adjustBox.classList.remove("hidden");

      // KPIs
      kpiTakeHome.classList.remove("hidden");
      salaryUsed.textContent = aed(salary);

      const savePct = (findItem(tpl,"Emergency Fund")?.p || 0) + (findItem(tpl,"Investing")?.p || 0);
      const saveAmt = (salary * savePct) / 100;

      kpiSavings.classList.remove("hidden");
      saveInvest.textContent = `${aed(saveAmt)} (${round1(savePct)}%)`;

      const rate = savingsRating(savePct);
      saveTag.className = `rounded-full border px-2.5 py-1 text-xs font-semibold ${rate.cls}`;
      saveTag.textContent = rate.text;

      saveBar.style.width = Math.min(100, Math.round(savePct * 2.2)) + "%";

      saveNote.textContent =
        cls.key === "low"
          ? "Priority: emergency buffer first; invest small and simple."
          : (cls.key === "mid"
              ? "Goal: 3–6 months emergency fund, then raise investing steadily."
              : "Aim for diversified long-term investing; keep lifestyle inflation controlled.");

      // Render list
      const hints = rentHints(locationKey);
      const commute = commuteHint(locationKey);

      budgetList.innerHTML = "";
      tpl.forEach(item => {
        const amt = (salary * item.p)/100;

        let sub = item.note;
        if(item.k === "Accommodation"){
          sub = `Typical rent bands in ${loc.name} (rough): shared ${aed(hints.shared[0])}–${aed(hints.shared[1])}, studio ${aed(hints.studio[0])}–${aed(hints.studio[1])}, 1BR ${aed(hints.onebr[0])}–${aed(hints.onebr[1])}.`;
        }
        if(item.k === "Commute"){
          sub = commute;
        }
        if(item.k === "Utilities"){
          sub = "Electricity/water (A/C season matters). Utilities can vary by usage and season.";
        }
        if(item.k === "Investing"){
          sub = (cls.key === "low")
            ? "Start after you have a small emergency buffer. Prefer low-fee diversified options."
            : "Prefer diversified, low-fee approach. Automate monthly contributions.";
        }

        const li = document.createElement("li");
        li.className = "rounded-2xl border border-slate-200 bg-slate-50 p-4";
        li.innerHTML = `
          <div class="flex items-start justify-between gap-3">
            <div class="text-sm font-bold text-slate-900">${item.k}</div>
            <div class="text-sm font-extrabold tabular-nums text-slate-900">${aed(amt)}</div>
          </div>
          <div class="mt-2 flex items-start justify-between gap-3">
            <div class="text-xs font-medium text-slate-600">${round1(item.p)}%</div>
            <div class="text-xs leading-5 text-slate-600 text-right">${sub}</div>
          </div>
        `;
        budgetList.appendChild(li);
      });
    }

    function setupSlidersFromBase(baseTpl){
      const baseAcc = findItem(baseTpl, "Accommodation")?.p ?? 0;
      const baseUtil = findItem(baseTpl, "Utilities")?.p ?? 0;

      const accB = sliderBoundsFor("Accommodation", baseAcc);
      const utilB = sliderBoundsFor("Utilities", baseUtil);

      // Configure sliders
      accSlider.min = String(accB.min);
      accSlider.max = String(accB.max);
      accSlider.value = String(Math.round(baseAcc));

      utilSlider.min = String(utilB.min);
      utilSlider.max = String(utilB.max);
      utilSlider.value = String(Math.round(baseUtil));

      // Labels
      accMinLabel.textContent = `min ${accB.min}%`;
      accBaseLabel.textContent = `base ${Math.round(baseAcc)}%`;
      accMaxLabel.textContent = `max ${accB.max}%`;

      utilMinLabel.textContent = `min ${utilB.min}%`;
      utilBaseLabel.textContent = `base ${Math.round(baseUtil)}%`;
      utilMaxLabel.textContent = `max ${utilB.max}%`;

      accPctLabel.textContent = `${Math.round(baseAcc)}%`;
      utilPctLabel.textContent = `${Math.round(baseUtil)}%`;

      sliderInitDone = true;
    }

    function renderWithCurrentSliders(){
      const salary = Number(salaryEl.value || 0);
      const locationKey = locEl.value;

      const base = buildBaseTemplate(salary, locationKey);
      lastBaseTpl = base.tpl;

      // If salary invalid
      if(base.cls.key === "none"){
        renderAll({ salary, locationKey, cls: base.cls, loc: base.loc, tpl: [] });
        return;
      }

      // If not initialized yet (or after calculate), set sliders to recommended base
      if(!sliderInitDone || !accSlider.dataset.ready){
        setupSlidersFromBase(base.tpl);
        accSlider.dataset.ready = "1";
        utilSlider.dataset.ready = "1";
      }

      const accPct = Number(accSlider.value);
      const utilPct = Number(utilSlider.value);

      accPctLabel.textContent = `${accPct}%`;
      utilPctLabel.textContent = `${utilPct}%`;

      const adjustedTpl = applyAdjustments(base.tpl, accPct, utilPct);

      renderAll({
        salary,
        locationKey,
        cls: base.cls,
        loc: base.loc,
        tpl: adjustedTpl
      });
    }

    // Calculate button (sets recommended plan + slider ranges)
    btn.addEventListener("click", () => {
      sliderInitDone = false;
      accSlider.dataset.ready = "";
      utilSlider.dataset.ready = "";
      renderWithCurrentSliders();
    });

    // Live update on sliders
    accSlider.addEventListener("input", renderWithCurrentSliders);
    utilSlider.addEventListener("input", renderWithCurrentSliders);

    // Reset sliders to recommended base
    resetAdjustBtn.addEventListener("click", () => {
      if(!lastBaseTpl || !lastBaseTpl.length){
        sliderInitDone = false;
        accSlider.dataset.ready = "";
        utilSlider.dataset.ready = "";
        renderWithCurrentSliders();
        return;
      }
      const baseAcc = findItem(lastBaseTpl, "Accommodation")?.p ?? 0;
      const baseUtil = findItem(lastBaseTpl, "Utilities")?.p ?? 0;

      accSlider.value = String(Math.round(baseAcc));
      utilSlider.value = String(Math.round(baseUtil));
      renderWithCurrentSliders();
    });

    // Defaults for demo
    salaryEl.value = 4500;
    locEl.value = "Dubai";
    // Initialize once
    renderWithCurrentSliders();
  </script>
</body>
</html>
